<!DOCTYPE html>
<html>
<head>
  <title>Registrar Portfolio | UCT DPCH WBA</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Registrar EPA Portfolio</h1>
  <p>UCT Department of Paediatrics and Child Health</p>
</header>

<section style="padding:40px;">
  <h2 id="registrarName"></h2>
  <div id="assessmentList"></div>
</section>

<section style="text-align:center; margin:40px;">
  <a href="dashboard.html"
     style="display:inline-block;
            padding:12px 30px;
            background:#002b5c;
            color:white;
            text-decoration:none;
            border-radius:8px;
            font-weight:bold;">
    ← Back to Dashboard
  </a>
</section>

<script>
window.addEventListener("DOMContentLoaded", function() {

  // 1️⃣ Get the selected registrar name from the URL
  const params = new URLSearchParams(window.location.search);
  const selectedName = params.get("name") || "Unknown Registrar";

  // Put the name in the page
  document.getElementById("registrarName").innerText = selectedName;

  // 2️⃣ Fetch live Form Responses
  fetch("https://docs.google.com/spreadsheets/d/16a8w-y1XCZ-1PcGCJQtW-14WO6IClLOtU0zgykvSCgk/gviz/tq?tqx=out:json&gid=25819344")
    .then(res => res.text())
    .then(text => {

      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;

      let html = "";

      rows.forEach(row => {

        const traineeName = row.c[2]?.v;  // Column C = Name
        const date = row.c[5]?.v;         // Column F = Date
        const hospital = row.c[8]?.v;     // Column I = Hospital

        // Only include rows for this registrar
        if (traineeName === selectedName) {
          html += `
            <div style="background:#f4f7fa; padding:20px; margin-bottom:15px; border-radius:8px;">
              <strong>Date:</strong> ${date || "–"}<br>
              <strong>Hospital:</strong> ${hospital || "–"}
            </div>
          `;
        }
      });

      if (html === "") {
        html = "<p>No assessments recorded yet for this registrar.</p>";
      }

      document.getElementById("assessmentList").innerHTML = html;

    });

});
</script>

</body>
</html>
